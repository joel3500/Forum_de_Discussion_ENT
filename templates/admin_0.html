{% extends "base.html" %}
{% block title %}Admin{% endblock %}
{% block content %}
<h3>Panneau Admin</h3>

<h5 class="mt-3">Sujets</h5>
<div class="list-group mb-3">
  {% for s in sujets %}
    <div class="list-group-item d-flex justify-content-between align-items-center">
      <div>
        <strong>#{{ s.id }} — {{ s.titre }}</strong>
        <div class="text-muted small">par {{ s.nom }} • {{ s.created_at }}</div>
      </div>
      <form method="post" action="{{ url_for('admin_delete_topic', topic_id=s.id) }}" onsubmit="return confirm('Supprimer ce sujet et tous ses commentaires ?');">
        <button class="btn btn-sm btn-danger">Supprimer</button>
      </form>
    </div>
  {% endfor %}
</div>

<h5>Commentaires récents</h5>
<div class="list-group mb-3">
  {% for c in comments %}
    <div class="list-group-item d-flex justify-content-between align-items-center">
      <div>
        <strong>#{{ c.id }}</strong> — {{ c.contenu|truncate(80) }}
        <div class="text-muted small">Sujet #{{ c.topic.id }} • {{ c.nom }} • {{ c.created_at }}</div>
      </div>
      <form method="post" action="{{ url_for('delete_comment', comment_id=c.id) }}">
        <button class="btn btn-sm btn-danger">Supprimer</button>
      </form>
    </div>
  {% endfor %}
</div>

<h5>Réponses récentes</h5>
<div class="list-group mb-3">
  {% for r in replies %}
    <div class="list-group-item d-flex justify-content-between align-items-center">
      <div>
        <strong>#{{ r.id }}</strong> — {{ r.contenu|truncate(80) }}
        <div class="text-muted small">Commentaire #{{ r.comment.id }} • {{ r.nom }} • {{ r.created_at }}</div>
      </div>
      <form method="post" action="{{ url_for('admin_delete_reply', reply_id=r.id) }}">
        <button class="btn btn-sm btn-danger">Supprimer</button>
      </form>
    </div>
  {% endfor %}
</div>

<h5>Utilisateurs</h5>
<ul class="list-group">
  {% for u in users %}
    <li class="list-group-item">
      <strong>#{{ u.id }} {{ u.nom }}</strong> — {{ u.email }} {% if u.is_admin == "yes" %}<span class="badge text-bg-dark">admin</span>{% endif %}
    </li>
  {% endfor %}
</ul>
{% endblock %}
